<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ doc.title }} - EaglePro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .btn-disabled {
            background-color: #6c757d !important;
            border-color: #6c757d !important;
            cursor: not-allowed !important;
            opacity: 0.6 !important;
        }

        .btn-disabled:hover {
            background-color: #6c757d !important;
            border-color: #6c757d !important;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .debug-info {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="eaglepro-header">
        <div class="header-container">
            <div class="logo-section">
                <div class="eaglepro-logo">
                    <h1>EaglePro</h1>
                    <div class="tagline">First American Financial Corporation</div>
                </div>
                <div class="environment-badge">DEMO</div>
            </div>
            <div class="user-nav">
                <div class="user-info">
                    <img src="{{ url_for('static', filename='images/' + current_user_avatar) }}" class="user-avatar" alt="Avatar">
                    <div class="user-details">
                        <div class="user-name">{{ username }}</div>
                        <div class="user-role">User ID: {{ user_id }}</div>
                    </div>
                </div>
                <a href="/dashboard" class="logout-btn">Back to Dashboard</a>
            </div>
        </div>
    </header>

    <div class="document-container">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        <div class="document-view">
            <!-- Document Header -->
            <div class="document-header">
                <div class="document-title-section">
                    <h1>{{ doc.title }}</h1>
                    <div class="document-meta">
                        <div class="meta-item">
                            <span class="meta-label">Document ID</span>
                            <span class="meta-value">{{ doc.id }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Owner</span>
                            <span class="meta-value">User {{ doc.user_id }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Type</span>
                            <span class="meta-value">{{ doc.doc_type }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Sensitivity</span>
                            <span class="meta-value">
                                <span class="sensitivity-tag sensitivity-{{ doc.sensitivity|lower }}">{{ doc.sensitivity }}</span>
                            </span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Created</span>
                            <span class="meta-value">{{ doc.created_date }}</span>
                        </div>
                    </div>
                </div>
                
                {% if is_vulnerable %}
                <div class="access-alert alert-vulnerable">
                    <div class="alert-icon">üö®</div>
                    <div class="alert-content">
                        <h3>IDOR VULNERABILITY EXPLOITED!</h3>
                        <p>You are viewing a document that <strong>DOES NOT BELONG</strong> to you!</p>
                        <div class="access-details">
                            <span class="your-id">Your User ID: {{ user_id }}</span>
                            <span class="owner-id">Document Owner: {{ doc.user_id }}</span>
                        </div>
                    </div>
                    <div class="cat-mini">
                        <img src="{{ url_for('static', filename='images/popcat.png') }}" alt="Popcat" class="cat-small">
                    </div>
                </div>
                {% else %}
                <div class="access-alert alert-legitimate">
                    <div class="alert-icon">‚úÖ</div>
                    <div class="alert-content">
                        <h3>Legitimate Access</h3>
                        <p>You are properly authorized to view this document.</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Document Content -->
            <div class="document-content">
                <div class="content-header">
                    <h3>Document Content</h3>
                    <div class="content-actions">
                        <button class="btn btn-primary" onclick="copyContent()">Copy Content</button>
                    </div>
                </div>
                <div class="content-body" id="documentContent">
{{ doc.content }}
                </div>
            </div>

            <!-- Navigation Section - QUAN TR·ªåNG -->
            <div class="document-navigation">
                <div class="nav-group">
                    <a href="/dashboard" class="btn btn-primary">
                        ‚Üê Back to Dashboard
                    </a>
                </div>
                
                <div class="nav-group">
                    {% if prev_doc_id %}
                    <a href="/document/{{ prev_doc_id }}" class="btn btn-danger">
                        ‚Üê Previous Document (ID: {{ prev_doc_id }})
                    </a>
                    {% else %}
                    <button class="btn btn-disabled" disabled>‚Üê No Previous Document</button>
                    {% endif %}
                    
                    {% if next_doc_id %}
                    <a href="/document/{{ next_doc_id }}" class="btn btn-danger">
                        Next Document (ID: {{ next_doc_id }}) ‚Üí
                    </a>
                    {% else %}
                    <button class="btn btn-disabled" disabled>No Next Document ‚Üí</button>
                    {% endif %}
                </div>
            </div>

            <!-- Debug Information (C√≥ th·ªÉ x√≥a sau khi test) -->
            <div class="debug-info">
                <strong>Debug Info:</strong><br>
                Current User ID: {{ user_id }}<br>
                Document Owner ID: {{ doc.user_id }}<br>
                Previous Document ID: {{ prev_doc_id }}<br>
                Next Document ID: {{ next_doc_id }}<br>
                Is Vulnerable Access: {{ is_vulnerable }}
            </div>
        </div>
    </div>

    <script>
        function copyContent() {
            const content = document.getElementById('documentContent').innerText;
            navigator.clipboard.writeText(content).then(() => {
                alert('Document content copied to clipboard!');
            });
        }
    </script>
</body>
</html>